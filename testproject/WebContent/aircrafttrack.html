<!DOCTYPE html>
<html>
<head>
    <title>Aircraft Tracker</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBEniBNlvvxqPCjeQTkSjb3lu6McZ2LBL0"></script>
    <style>
        #map {
            height: 100%;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        let map;
        let aircraftMarkers = {};

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 20.5937, lng: 78.9629},
                zoom: 5
            });
            fetchAircraftData(); // Initial fetch
            setInterval(fetchAircraftData, 120000); 
        }

        function fetchAircraftData() {
            fetch('/testproject/api/aircrafts') // Update the endpoint if necessary
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Error fetching aircraft data:', data.error);
                    } else {
                        updateAircraftPositions(data);
                    }
                })
                .catch(error => {
                    console.error('Error fetching aircraft data:', error);
                });
        }

        function updateAircraftPositions(data) {
            data.states.forEach(aircraft => {
                const id = aircraft[0];
                const latitude = aircraft[6];
                const longitude = aircraft[5];
                const altitude = aircraft[7];

                if (!aircraftMarkers[id]) {
                    const marker = new google.maps.Marker({
                        position: {lat: latitude, lng: longitude},
                        map: map,
                        icon: {
                            url: 'images/airplane.png', 
                            scaledSize: new google.maps.Size(32, 32)
                        },
                        title: `Aircraft ${id}`
                    });

                    const infoWindow = new google.maps.InfoWindow({
                        content: `
                            <div>
                                <strong>Aircraft ${id}</strong><br>
                                Latitude: ${latitude}<br>
                                Longitude: ${longitude}<br>
                                Altitude: ${altitude}
                            </div>`
                    });

                    marker.addListener('click', () => {
                        infoWindow.open(map, marker);
                    });

                    aircraftMarkers[id] = marker;
                } else {
                    const marker = aircraftMarkers[id];
                    const newPosition = new google.maps.LatLng(latitude, longitude);
                    marker.setPosition(newPosition);
                    marker.setTitle(`Aircraft ${id} - Altitude: ${altitude}`);
                }
            });
        }

        google.maps.event.addDomListener(window, 'load', initMap);
    </script>
</body>
</html>
