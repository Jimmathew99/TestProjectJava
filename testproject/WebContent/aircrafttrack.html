<!DOCTYPE html>
<html>
<head>
    <title>Aircraft Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 100%;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        .card {
            max-width: 300px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .card img {
            max-width: 100%;
            border-radius: 5px;
        }
        .card .card-body {
            padding: 10px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        let map = L.map('map').setView([20.5937, 78.9629], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        let aircraftMarkers = {};

        function fetchAircraftData() {
            const lamin = 6.0; // Example values, replace with actual coordinates
            const lomin = 68.0;
            const lamax = 37.0;
            const lomax = 97.0;

            const url = `/testproject/api/aircrafts?lamin=${lamin}&lomin=${lomin}&lamax=${lamax}&lomax=${lomax}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Error fetching aircraft data:', data.error);
                    } else {
                        updateAircraftPositions(data);
                    }
                })
                .catch(error => {
                    console.error('Error fetching aircraft data:', error);
                });
        }

        function updateAircraftPositions(data) {
            data.states.forEach(aircraft => {
                const id = aircraft[0];
                const latitude = aircraft[6];
                const longitude = aircraft[5];
                const altitude = aircraft[7];

                if (!aircraftMarkers[id]) {
                    const marker = L.marker([latitude, longitude], {
                        icon: L.icon({
                            iconUrl: 'images/airplane.png',
                            iconSize: [32, 32]
                        }),
                        title: `Aircraft ${id}`
                    }).addTo(map);

                    const infoWindowContent = `
                        <div class="card">
                            <img src="https://via.placeholder.com/150" alt="Aircraft ${id}">
                            <div class="card-body">
                                <strong>Aircraft ${id}</strong><br>
                                Latitude: ${latitude}<br>
                                Longitude: ${longitude}<br>
                                Altitude: ${altitude}
                            </div>
                        </div>`;
                    marker.bindPopup(infoWindowContent);

                    aircraftMarkers[id] = marker;
                } else {
                    const marker = aircraftMarkers[id];
                    const newPosition = [latitude, longitude];
                    marker.setLatLng(newPosition);
                    marker.setPopupContent(`
                        <div class="card">
                            <img src="https://via.placeholder.com/150" alt="Aircraft ${id}">
                            <div class="card-body">
                                <strong>Aircraft ${id}</strong><br>
                                Latitude: ${latitude}<br>
                                Longitude: ${longitude}<br>
                                Altitude: ${altitude}
                            </div>
                        </div>`);
                }
            });
        }

        fetchAircraftData(); // Initial fetch
        setInterval(fetchAircraftData, 1200000); // Fetch data every 2 minutes
    </script>
</body>
</html>
